{% extends 'base.html.twig' %}

{% block title %}Gestion des Utilisateurs
{% endblock %}

{% block body %}
	<div class="container-xxl">
		<div class="card">
			<div class="card-header d-flex justify-content-between align-items-center bg-navbar-theme">
				<h5 class="mb-0">
					<i class='bx bx-user'></i>
					Liste des Utilisateurs
				</h5>
				<a href="{{ path('app_user_new') }}" class="btn btn-primary">
					<i class='bx bx-plus'></i>
					Nouveau
				</a>
			</div>

			<div class="card-body">
				<div class="mb-3">
					<div class="btn-group" role="group">
						<a href="{{ path('app_user_index') }}" class="btn btn-sm {{ currentFilter == 'all' ? 'btn-primary' : 'btn-outline-primary' }}">
							<i class='bx bx-list-ul'></i>
							Tous
						</a>
						<a href="{{ path('app_user_index', {filter: 'admin'}) }}" class="btn btn-sm {{ currentFilter == 'admin' ? 'btn-danger' : 'btn-outline-danger' }}">
							<i class='bx bx-shield'></i>
							Administrateurs
						</a>
						<a href="{{ path('app_user_index', {filter: 'user'}) }}" class="btn btn-sm {{ currentFilter == 'user' ? 'btn-success' : 'btn-outline-success' }}">
							<i class='bx bx-user'></i>
							Utilisateurs
						</a>
					</div>
				</div>
				<div class="table-responsive text-nowrap">
					<table class="table table-hover">
						<thead>
							<tr>
								<th>#</th>
								<th>Noms</th>
								<th>Nom Utilisateur</th>
								<th>Rôles</th>
								<th>Date de création</th>
								<th>Actions</th>
							</tr>
						</thead>
						<tbody class="table-border-bottom-0">
							{% for user in users %}
								<tr>
									<td>
										<strong>{{ loop.index }}</strong>
									</td>
									<td>
										<div class="d-flex align-items-center">
											<div class="avatar avatar-sm me-2">
												<span class="avatar-initial rounded-circle bg-primary">
													{% if user.prenom %}
														{{ user.prenom|first|upper }}
													{% else %}
														{{ user.username|first|upper }}
													{% endif %}
												</span>
											</div>
											<div>
												{% if user.prenom or user.nom %}
													{{ user.prenom }}
													{{ user.nom }}
												{% else %}
													<span class="text-muted">-</span>
												{% endif %}
											</div>
										</div>
									</td>
									<td>
										<span class="label-secondary">

											{{ user.username }}
										</span>
									</td>
									<td>
										{% for role in user.roles %}
											{% if role == 'ROLE_ADMIN' %}
												<span class="badge bg-danger">Admin</span>
											{% elseif role == 'ROLE_MANAGER' %}
												<span class="badge bg-warning">Manager</span>
											{% elseif role == 'ROLE_USER' %}
												<span class="badge bg-primary">User</span>
											{% endif %}
										{% endfor %}
									</td>
									<td>
										<small class="text-muted">{{ user.createdAt ? user.createdAt|date('d/m/y H:i') : '-' }}</small>
									</td>
									<td>
										<div class="d-flex gap-1">
											<div class="dropdown">
												<button type="button" class="btn p-0 dropdown-toggle hide-arrow" data-bs-toggle="dropdown">
													<i class="bx bx-dots-vertical-rounded"></i>
												</button>
												<div class="dropdown-menu">
													<a href="{{ path('app_user_show', {'id': user.id}) }}" class="dropdown-item">
														<i class="bx bx-user me-1"></i>Voir
													</a>
													<a href="{{ path('app_user_edit', {'id': user.id}) }}" class="dropdown-item">
														<i class="bx bx-pencil me-1"></i>
														Modifier
													</a>
													<form method="post" action="{{ path('app_user_delete', {'id': user.id}) }}" onsubmit="return confirm('Voulez-vous vraiment supprimer cet utilisateur ?');">
														<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ user.id) }}">
														<button type="submit" class="dropdown-item text-danger">
															<i class="bx bx-trash me-1"></i>
															Supprimer
														</button>
													</form>
												</div>
											</div>
										</div>
									</td>
								</tr>
							{% else %}
								<tr>
									<td colspan="6" class="text-center py-4">
										<i class='bx bx-info-circle bx-md text-muted'></i>
										<p class="text-muted mt-2">Aucun utilisateur trouvé</p>
										<a href="{{ path('app_user_new') }}" class="btn btn-sm btn-primary">
											<i class='bx bx-plus'></i>
											Créer le premier utilisateur
										</a>
									</td>
								</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
{% endblock %}
